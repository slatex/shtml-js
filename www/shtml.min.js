var __awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function a(t){try{l(r.next(t))}catch(t){s(t)}}function i(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,i)}l((r=r.apply(t,e||[])).next())}))},__generator=this&&this.__generator||function(t,e){var n,r,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},SHTML_CSS=void 0;function shtml_init_css(){if(!SHTML_CSS){(SHTML_CSS=document.createElement("style")).setAttribute("type","text/css"),SHTML_CSS.styleSheet&&(SHTML_CSS.styleSheet.cssText=""),document.head.appendChild(SHTML_CSS);var t=shtml_get_css_classes(),e=[".shtml-varcomp",".shtml-symcomp",".shtml-definiendum",".shtml-on-hover",".shtml-hover-window",".shtml-barrier"];shtml_add_style((e=e.filter((function(e){return!t.includes(e)}))).map((function(t){switch(t){case".shtml-varcomp":return".shtml-varcomp { color: #828282; }";case".shtml-symcomp":return".shtml-symcomp { color: #0e90d2; }";case".shtml-definiendum":return".shtml-definiendum { color: #ed028c; }";case".shtml-on-hover":return".shtml-on-hover { background-color: yellow; cursor: pointer;display:inline }";case".shtml-hover-window":return".shtml-hover-window { position: absolute; background:#f9f9f9; max_width:800px; box-shadow: 0 0 10px rgba(0,0,0,0.5); display:block;padding:5px; }";case".shtml-barrier":return".shtml-barrier { pointer-events:none;display:block;position:absolute;top:0;left:0;padding:0;margin:0;width:100vw;height:100vh;opacity:0;background-color:#000; }"}})).join("\n"))}}function shtml_add_style(t){SHTML_CSS||shtml_init_css(),SHTML_CSS.styleSheet?SHTML_CSS.styleSheet.cssText+=t:SHTML_CSS.appendChild(document.createTextNode(t))}function shtml_get_css_classes(){for(var t=[],e=0;e<document.styleSheets.length;e++){var n=document.styleSheets[e],r=null;try{r=n.cssRules||n.rules}catch(t){console.warn("Cannot read cssRules from stylesheet; likely due to same-origin policy.",t);continue}for(var o=0;o<r.length;o++){var s=r[o];s instanceof CSSStyleRule&&t.push(s.selectorText)}}return t}var WINDOW=window,HTML_NS="http://www.w3.org/1999/xhtml",MATHML_NS="http://www.w3.org/1998/Math/MathML",SHTML_NS="http://kwarc.info/ns/SHTML";WINDOW.SHTML_SERVER||(WINDOW.SHTML_SERVER="https://stexmmt.mathhub.info/:sTeX");var USE_RAW=!1,SHTML_LISTENER=new MutationObserver((function(t){t.forEach((function(t){t.addedNodes.forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&do_shtml(t)}))}))}));function shtml_initialize(){shtml_init_css()}document.addEventListener("DOMContentLoaded",(function(){SHTML_LISTENER.observe(document.body,{childList:!0,subtree:!0}),shtml_initialize(),do_shtml(document.body)}));var SHTMLTerm,shtml_definitionsMap=new Map,shtml_indefinition=void 0;function do_shtml(t){for(var e=function(){t.childNodes.forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&do_shtml(t)}))},n=0;n<t.attributes.length;n++){var r=t.attributes[n];if(r.name.startsWith("shtml:")){var o=r.name.substring(6);switch(o){case"visible":if("false"===r.value)return;case"definiendum":t.classList.add("shtml-definiendum"),shtml_indefinition&&shtml_definitionsMap.set(r.value,shtml_indefinition);break;case"sourceref":case"doctitle":case"sectionlevel":case"metatheory":case"language":case"signature":case"import":case"id":case"inline":case"statementtitle":case"vardef":case"definiens":case"notationid":case"head":case"fors":case"argmode":case"arg":case"macroname":break;case"theory":return shtml_do_theory(t),void e();case"term":return void shtml_do_term(t);case"feature-structure":return shtml_do_mathstructure(t),void e();case"definition":shtml_do_definition(t);var s=shtml_indefinition;return shtml_indefinition=t,e(),void(shtml_indefinition=s);default:console.log("SHTML attribute not implemented: ",o)}}}e()}function shtml_do_theory(t){var e,n,r=null===(e=t.attributes.getNamedItem("shtml:theory"))||void 0===e?void 0:e.value,o=null===(n=t.attributes.getNamedItem("shtml:metatheory"))||void 0===n?void 0:n.value;console.log("SHTML theory: ".concat(r," : ").concat(o))}function shtml_do_mathstructure(t){var e,n,r=null===(e=t.attributes.getNamedItem("shtml:feature-structure"))||void 0===e?void 0:e.value,o=null===(n=t.attributes.getNamedItem("shtml:macroname"))||void 0===n?void 0:n.value;console.log("SHTML mathstructure: ".concat(r," (\\").concat(o,")"))}function shtml_do_definition(t){var e,n=null===(e=t.attributes.getNamedItem("shtml:fors"))||void 0===e?void 0:e.value.split(",").map((function(t){return t.trim()}));n&&(console.log("SHTML definition for: ",n),n.forEach((function(e){shtml_definitionsMap.set(e,t)})))}function shtml_do_term(t){var e=shtml_parse_term_kind(t),n=shtml_get_term_components(t);n.args.forEach((function(t){do_shtml(t)})),shtml_add_symbol_hover(new SHTMLHoverable(e,n))}function shtml_parse_term_kind(t){var e,n,r=null===(e=t.attributes.getNamedItem("shtml:term"))||void 0===e?void 0:e.value,o=(null===(n=t.attributes.getNamedItem("shtml:head"))||void 0===n?void 0:n.value).split("?").length>1;switch(r){case"OMID":return o?SHTMLTerm.OMID:SHTMLTerm.OMV;case"OMV":return SHTMLTerm.OMV;case"OMA":return o?SHTMLTerm.OMA_OMID:SHTMLTerm.OMA_OMV;case"OMB":return o?SHTMLTerm.OMB_OMID:SHTMLTerm.OMB_OMV}}!function(t){t[t.OMID=0]="OMID",t[t.OMV=1]="OMV",t[t.OMA_OMID=2]="OMA_OMID",t[t.OMA_OMV=3]="OMA_OMV",t[t.OMB_OMID=4]="OMB_OMID",t[t.OMB_OMV=5]="OMB_OMV"}(SHTMLTerm||(SHTMLTerm={}));var SHTMLTermData=function(){};function shtml_get_term_components(t){var e,n=[],r=[],o=null===(e=t.attributes.getNamedItem("shtml:head"))||void 0===e?void 0:e.value;return function t(e){if(e.attributes.getNamedItem("shtml:arg"))r.push(e);else{var o=e.attributes.getNamedItem("shtml:comp");o||(o=e.attributes.getNamedItem("shtml:maincomp"))||(o=e.attributes.getNamedItem("shtml:varcomp"))?n.push(e):e.childNodes.forEach((function(e){e.nodeType===Node.ELEMENT_NODE&&t(e)}))}}(t),{components:n,args:r,symbolname:o}}var SHTMLSymbolOrVar,shtml_tooltip_counter=0,shtml_tooltip_created=!1;function shtml_tooltip_inc(){shtml_tooltip_created&&(shtml_tooltip_counter++,shtml_tooltip_created=!1)}!function(t){t[t.Symbol=0]="Symbol",t[t.Var=1]="Var"}(SHTMLSymbolOrVar||(SHTMLSymbolOrVar={}));var SHTMLHoverable=function(t,e){switch(t){case SHTMLTerm.OMV:case SHTMLTerm.OMA_OMV:case SHTMLTerm.OMB_OMV:this.tp=SHTMLSymbolOrVar.Var;break;default:this.tp=SHTMLSymbolOrVar.Symbol}this.path=e.symbolname,this.elems=e.components};function shtml_add_symbol_hover(t){t.tp===SHTMLSymbolOrVar.Var?t.elems.forEach((function(e){e.classList.add("shtml-varcomp"),e.addEventListener("mouseover",(function(e){return shtml_hover_variable(t.path,t.elems,e)}))})):t.elems.forEach((function(e){e.classList.add("shtml-symcomp"),e.addEventListener("mouseover",(function(e){return shtml_hover_symbol(t.path,t.elems,e)}))}))}function shtml_common_hover(t,e,n){t.forEach((function(t){t.classList.add("shtml-on-hover")}));var r=Math.max.apply(Math,t.map((function(t){var e=window.getComputedStyle(t).getPropertyValue("z-index");return"auto"===e?10:parseInt(e,10)}))),o=document.createElement("div");o.classList.add("shtml-barrier"),o.style.zIndex=(r+1).toString();var s=document.body;s.appendChild(o);var a=document.createElement("div");a.style.zIndex=(r+2).toString(),a.classList.add("shtml-hover-window"),a.style.left=e.pageX-20+"px",a.style.top=e.pageY-20+"px",a.addEventListener("mouseleave",(function(e){return shtml_destroy_hover([a,o],t)})),n(a),s.appendChild(a)}function shtml_hover_symbol(t,e,n){return __awaiter(this,void 0,void 0,(function(){var r=this;return __generator(this,(function(o){return shtml_common_hover(e,n,(function(e){return __awaiter(r,void 0,void 0,(function(){var n,r,o,s;return __generator(this,(function(a){switch(a.label){case 0:return(n=shtml_definitionsMap.get(t))?(e.innerHTML=n.innerHTML,[3,5]):[3,1];case 1:return a.trys.push([1,4,,5]),[4,fetch("".concat(WINDOW.SHTML_SERVER,"/").concat(USE_RAW?"raw":"","fragment?").concat(t))];case 2:if(!(r=a.sent()).ok)throw new Error("HTTP error "+r.status);return[4,r.text()];case 3:return o=a.sent(),e.innerHTML=o,[3,5];case 4:return s=a.sent(),console.error(s),e.innerText="Symbol ".concat(t),[3,5];case 5:return[2]}}))}))})),[2]}))}))}function shtml_hover_variable(t,e,n){shtml_common_hover(e,n,(function(e){return e.innerText="Variable ".concat(t)}))}function shtml_destroy_hover(t,e){t.forEach((function(t){return t.remove()})),e.forEach((function(t){t.classList.remove("shtml-on-hover")}))}function shtml_is_mathml(t){for(var e=t;e;){if(e.namespaceURI===MATHML_NS)return!0;if(e.namespaceURI===HTML_NS)return!1;e=e.parentNode}}function shtml_nearest_non_math(t){if(!shtml_is_mathml(t))return t;shtml_nearest_non_math(t.parentNode)}